<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" lang="ru">
    <title>3detail admin</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">



</head>
<body>
<header>
    <div class="container">
        <div class="row">
            <div class="col-4" >
                <!--картинка группы  @{'/image_group/' + ${fileName}}   "@{'/image_group/new.jpg'}" -->
                <img src="/image/main_logo.png"  style="max-height: 80px;">
            </div>
            <div class="col-8">
                <h3 class="text-center text-white"> 3detail администратор new product </h3>
<!--                <h4 class="text-center text-white"> администратор </h4>-->
            </div>
        </div>
    </div>
</header>

<!--Контейнер со строками-->
<div class="container">
    <!--   строка с картинкой   -->
    <div class="row">
        <div class="col-8">
            <p></p>
            <h3> <a th:text="'Редактор продукта: ' + ${product.getProduct_name}"></a></h3>
            <p></p>

            <p></p>
            <!--Отображение картинок-->
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div th:each="nameImages: ${ListNameImages}" class="col-md-3 my-3">

                            <a th:href="'/del/image/'+ ${product.getProductId()}+ '/' + ${nameImages} + '?currentGroupId=' + ${currentGroupId}"
                               class="del_img">
                                <img th:src="@{'/image/product/'+ ${product.getProductId()}+ '/' + ${nameImages}}"
                                     class="img-fluid mx-auto d-block" style="width: 100%; height: auto;" alt="Описание">
                                <input type="hidden" name="currentGroupId" th:value="${currentGroupId}">
                            </a>

                            <h3> <a th:id="'name_' + ${nameImages}" ></a></h3>

<!--                            выбор имени картинки для смены - изменить порядок-->
<!--                            <label for="groups">Раздел: </label>-->
                            <form method="post" th:action = "'/index_admin/' + ${product.getProductId()} +'/change_name_image'">
<!--                                поле для отправки текущего имени картинки-->
                                <input type="hidden" name="currentNameImage" th:value="${nameImages}">

                                <select th:id="'select_name_for_image' + ${nameImages}" th:name="'select_new_name'"
                                        class="form-select form-select-sm"
                                        style="width: auto; height: 35px; font-size: 18px;"
                                        onchange="this.form.submit();">
                                    <option th:each="name : ${ListNameImagesNoExpansion}"

                                            th:value="${name}"
                                            th:id="'name_instal' + ${name}"
                                            th:text="${name}"></option>
                                </select>
                            </form>
                    </div>
                </div>
            </div>

            <!--скрипт для выбора нового имени(номера) картинки-->
            <script th:inline="javascript">
                const lsitNameImages = [[${ListNameImages}]]; // Массив имен изображений
                const lsitNameImagesNoExpansion = [[${ListNameImagesNoExpansion}]]; // Массив имен изображений

                // Проход по имени каждой картинки
                for (let i = 0; i < lsitNameImages.length; i++) {
                    // let currentNameImage = lsitNameImages[i];

                    const currentName = document.getElementById("name_" + lsitNameImages[i]);
                    currentName.textContent = lsitNameImages[i];  //установка имени картинки

                    // seletct - поле соответств. одной из групп в селекторе

                    const currentSelect = document.getElementById("select_name_for_image" + lsitNameImages[i]);
                    if (currentSelect) {
                        // Просматриваем все доступные опции
                        const options = Array.from(currentSelect.options);
                        for (let opt of options) {
                            // Если текст опции равен имени изображения
                            if (opt.text === lsitNameImagesNoExpansion[i]) { // установка в селекте имнни без расширения
                                opt.selected = true; // делаем данную опцию выбранной
                                break;
                            }
                        }
                    }
                    // const currentseletct = document.getElementById("listName_for_image" + lsitNameImages[i]);
                    // currentseletct.setAttribute(lsitNameImages[i].textContent, "true");
                }
            </script>

<!--Загрузка картинки-->
            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-md-12 border p-4 rounded shadow-lg bg-body-secondary">
                        <form method="post" enctype="multipart/form-data"
                              th:action="'/upload_image_product/' + ${product.getProductId()}"
                              th:object="${image}">   <!--связывает форму с объектом image-->
                            <input type="file" name="file" accept="image/*" required/>  <!--accept="image/*" допустимые файлы image-->
                            <button type="submit">Загрузить изображение</button>

                            <!-- вспомогательная переменная и сохранение выбора в селект -->
                            <input type="hidden"  name="currentGroupId"  th:value="${currentGroupId}" />

                        </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- конец строка с картинкой   -->

<!--Контейнер для формы кнопки сохранить-->
<div>
    <form method="post" th:action = "'/index_admin/save_product/' + ${product.getProductId()}"
          th:id="'save_product_' + ${product.getProductId()}">

        <!-- включение отображение картинок checkbox-->
        <input type="checkbox" class="form-check-input" id="checkboxViewImage"  name="no_image_view" value="no_view_image" /> Не оторбражать картинки
        <p></p>
        <!-- вспомогат перемн. для состояния чекбокса отображение картинки на сайте-->
        <input type="hidden" id="no_view_image" th:value="${product.getView_image()}"/>

        <!-- включение доступности загрузки продукта пользователем checkbox-->
        <input type="checkbox" class="form-check-input" id="checkboxIsLoad"  name="is_load" value="load" /> Доступно для заказа пользователем
        <p></p>
        <!-- вспомогат перемн. для состояния чекбокса доступности загрузки-->
        <input type="hidden" id="isLoad" th:value="${product.getIsLoad}"/>

        <script>
            // <!--назначение атрибута checked для чекбокса отображения картинок-->
            const hiddenViewImage = document.getElementById("no_view_image");
            const checkViewImage = document.getElementById("checkboxViewImage");

            checkViewImage.checked = (hiddenViewImage.value === "no_view_image")

            // <!--назначение атрибута checked для чекбокса доступности загрузки-->
            const hiddenIsLoad = document.getElementById("isLoad");
            const checkIsload = document.getElementById("checkboxIsLoad");

            checkIsload.checked = (hiddenIsLoad.value === "load")


        </script>



    <!--   строка 1   -->
    <div class="row">
        <div class="col-8">
            <!--Вывод сообщения об ошибке-->
            <h4>   <a th:text="${errorMessage}" > </a>   </h4>
            <P></P>

            <div class="btn-group" role="group" > <!--ссылки в один ряд-->
            <!--Ссылка на главную страницу-->
            <a th:href="'/index_admin'" class="text-black text-decoration-none" style="margin-right: 20px; font-weight: bold;" th:text="'На главную ->'"></a>

            <!--Ссылка в раздел страницу-->
            <a th:href="'/index_admin/group/' + ${currentGroupId}" class="text-black text-decoration-none" style="margin-right: 20px; font-weight: bold;" th:text="'В раздел ->'"></a>

                <!--Ссылка все продукты-->
                <a th:href="'/product/all'" class="text-black text-decoration-none"
                   style="margin-right: 20px; font-weight: bold;" th:text="'Все продукты ->'"></a>
            </div>
                <p></p>

            <!--Кнопка сохранить продукт -->
<!--            <div class="col-1">-->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-dark btn-sm mb-2" type="submit"
                                style="height: 35px; width: 110px; font-size: 16px;">Сохранить</button>

                        <!--                                     внутри формы
                                                     newHiddenInput_save.value = gr.groupName;                  // Значение поля имя
                                                    newHiddenInput_save.name = "group_save_" + gr.groupId;       // Имя параметра на сохранение группы-->

                    </div>

<!--            общаяя инфо о продукте-->

            <div class="container mt-5">
                <div class="row justify-content-center">
                    <div class="col-md-12 border p-4 rounded shadow-lg bg-body-secondary">
                        <p></p>

                        <!--выбор группы продукта-->

                        <div class="d-flex align-items-center mb-3">
                            <label for="groups">Раздел: </label>
                            <select id="groups" name="group_Id"
                                    class="form-select form-select-sm"
                                    style="width: auto; height: 35px; font-size: 18px;">
                                <option th:each="group : ${groups}"

                                        th:value="${group.getGroupId() ?: 'null'}"
                                        th:id="'group' + ${group.getGroupId()}"
                                        th:text="${group.getGroupName()}"></option>
                            </select>
                        </div>

                        <!-- вспомогательная переменная и сохранение выбора в селект -->
<!--                        <input type="hidden"  id="hiddenGroupSelect"  th:value="${currentGroupId}" />-->
                        <input type="hidden" id="hiddenGroupSelect" th:value="${currentGroupId ?: 'null'}"/>


                            <!--скрипт для выбора текущей группы-->
                        <script>
                            const currentGroup = document.getElementById("hiddenGroupSelect");

                            // seletct - поле соответств. одной из групп в селекторе
                            const seletct = document.getElementById("group" + currentGroup.getAttribute("value"));
                            seletct.setAttribute("selected", "true");

                        </script>
                        <!--конец выбор группы продукта-->
                    <p></p>

                        <!-- ИМЯ -->
                        <div class="d-flex align-items-center mb-3">
                            <label for="product_name" class="me-2">Наименование: </label>
                            <input class="form-control flex-grow-1" id="product_name"
                                   th:value="${product.getProduct_name}"
                                   type="text" name="product_name" size="50"/>
                        </div>

                        <p></p>

                        <!-- Стоимость -->

                        <div class="d-flex align-items-center mb-3">
                            <label for="coast_product" class="me-2">Цена: </label>
                            <input class="form-control flex-grow-1" id="coast_product"
                                   th:value="${product.getProductCoast}"
                                   type="text" name="coast_product" size="25"/>
                        </div>

                        <p></p>
                        <!-- Количество -->
                        <div class="d-flex align-items-center mb-3">
                            <label for="count_product" class="me-2">Количество: </label>
                            <input class="form-control flex-grow-1" id="count_product"
                                   th:value="${product.getProductCount}"
                                   type="text" name="count_product" size="15"/>
                        </div>

                    </div>
                </div>

                </div>
            <p></p>

        </div>
    <!--конец строка 1-->

        <!--        перечисление картинок с описанием-->
        <div class="container mt-5">
                <div th:each="nameImages: ${ListNameImages}" class="col-md-11 my-3">
                    <input type="hidden"  th:value="${nameImages.hashCode}">
                    <div class="row">
                        <div class="col-3">
                        <a th:href="'/del/image/'+ ${product.getProductId()}+ '/' + ${nameImages} + '?currentGroupId=' + ${currentGroupId}"
                           class="del_img">
                            <img th:src="@{'/image/product/'+ ${product.getProductId()}+ '/' + ${nameImages}}"
                                 class="img-fluid mx-auto d-block" style="width: 100%; height: auto;" alt="Описание">
                            <input type="hidden" name="currentGroupId" th:value="${currentGroupId}">
                        </a>
                    </div>
                        <!--   строка Описание   -->
                        <div class="col-6">
                                        <!-- Описание картинки - установливается с помощью скрипта -->
                            <div class="d-flex flex-column mb-3">
                                <label th:for="'description_' + ${nameImages}" class="mb-2">Описание:</label>
                                <textarea class="form-control"
                                          th:id="'description_' + ${nameImages}"
                                          th:name="'product_description$' + ${nameImages}"
                                          rows="8">
                    </textarea>
                            </div>
                        </div>
                    </div>
                </div>
<!--            добавить строку "no_image" если таковая имеется в mapDescription-->
            <div class="row">
                <div th:if="${mapDescription.containsKey('no_image')}" class="col-5">
                    <label th:for="'description_no_image'" class="mb-2">Описание без картинки:</label>
                    <textarea class="form-control"
                              th:text="${mapDescription[no_image]}"
                              th:id="'description_no_image'" th:name="'product_description$no_image'"
                              rows="8">
                                </textarea>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            // Преобразование Java-коллекций в JavaScript-объекты
            const images = [[${ListNameImages}]]; // Массив изображений
            const descriptions = [[${mapDescription}]]; // Мапа описаний

            // Проход по каждой картинке
            for (let i = 0; i < images.length; i++) {
                let image = images[i];

                // Находим элемент по id
                const textArea = document.getElementById(`description_${image}`);

                if (textArea && descriptions.hasOwnProperty(image)) { // Проверяем наличие и доступность
                    textArea.value = descriptions[image]; // Устанавливаем значение
                }
            }
        </script>

        <p></p>

        <!--   строка  ТЕГИ   -->
        <div class="row">
            <div class="col-8">
                <div class="container mt-5">
                    <div class="row justify-content-center">
                        <div class="col-md-12 border p-4 rounded shadow-lg bg-body-secondary">

                            <!-- Описание -->
                            <div class="d-flex flex-column mb-3">
                                <label for="teg" class="mb-2">Теги (для поисковиков):<br>
                                разделить на две части символом ";"<br>
                                1-я описание то что будет видно на странице поиска"<br>
                                2-я набор ключевых слов по которым поисковик найдет данную страницу
                                </label>
                                <textarea class="form-control"

                                          th:text="${product.teg}"
                                          id="teg" name="teg_product" rows="8">


                            </textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>    <!--конец строка 2-->

    </form> <!--формма кнопки сохранить-->

</div> <!--Контейнер для формы кнопки сохранить-->

    </div>



<style>
    label {
        font-size: 17px;
        font-weight: bold;
        text-align: left;
    }
</style>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        // Все ссылки с классом delete-image
        const deleteLinks = document.querySelectorAll('.del_img');

        // Обработчик события клика
        deleteLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // Предотвращаем стандартный переход по ссылке

                // Подтверждение удаления
                if(confirm('Удалить изображение???')) {
                    // Если подтвердили, перенаправляемся вручную
                    window.location.href = this.href;
                }
            });
        });
    });
</script>



</body>
</html>